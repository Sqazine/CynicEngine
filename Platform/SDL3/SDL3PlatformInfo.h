#pragma once

#include "Platform/PlatformInfo.h"
#include <SDL3/SDL_vulkan.h>
#include <SDL3/SDL.h>
#include "Logger/Logger.h"
#include "SDL3Window.h"
#include "Platform/Window.h"
namespace CynicEngine
{
    class SDL3VulkanPlatformInfo : public VulkanPlatformInfo
    {
        std::vector<const char *> GetWindowInstanceExtension()
        {
            uint32_t extensionCount;

            auto rawExts = SDL_Vulkan_GetInstanceExtensions(&extensionCount);
            std::vector<const char *> result(extensionCount);
            for (size_t i = 0; i < extensionCount; ++i)
            {
                result[i] = rawExts[i];
            }
            return result;
        }

        VkSurfaceKHR CreateSurface(const Window *window, VkInstance instance)
        {
            SDL_Window *sdlWindow = static_cast<const SDL3Window *>(window)->GetHandle();
            VkSurfaceKHR result;
            SDL_Vulkan_CreateSurface(sdlWindow, instance, nullptr, &result);
            return result;
        }
    };

    class SDL3HardwareInfo : public HardwareInfo
    {
    public:
        void ObtainDisplayInfo() override
        {
            int numDisplays = 0;
            auto displays = SDL_GetDisplays(&numDisplays);

            if (numDisplays <= 0)
            {
                CYNIC_ENGINE_LOG_ERROR(TEXT("Failed to get displays: {}"), SDL_GetError());
                return;
            }

            mDisplayInfos.clear();
            mDisplayInfos.reserve(numDisplays);

            for (int i = 0; i < numDisplays; ++i)
            {
                SDL_Rect rect;
                SDL_DisplayID displayID = displays[i];
                SDL_GetDisplayBounds(displayID, &rect);

                DisplayInfo info;
                info.width = rect.w;
                info.height = rect.h;

                mDisplayInfos.push_back(info);
            }
        }
    };
}